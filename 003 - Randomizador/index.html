<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Randomizador</title>
    <meta
      name="description"
      content="Un randomizador de planes para elegir quÃ© hacer hoy."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Sedgwick+Ave+Display&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Jersey+10&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        color-scheme: dark;
        --bg: #161a14;
        --card: rgba(28, 34, 29, 0.94);
        --text: #bfd5b3;
        --muted: rgba(191, 213, 179, 0.65);
        --accent: #bfd5b3;
        --accent-2: #8fbf9b;
        --border: rgba(255, 255, 255, 0.1);
        --shadow: 0 18px 40px rgba(0, 0, 0, 0.45);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        background: radial-gradient(
            700px circle at 20% 10%,
            rgba(191, 213, 179, 0.12),
            transparent 60%
          ),
          radial-gradient(
            600px circle at 85% 20%,
            rgba(143, 191, 155, 0.12),
            transparent 65%
          ),
          var(--bg);
        color: var(--text);
        font-family: "Jersey 10", "Segoe UI", sans-serif;
      }

      main {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        padding: 32px 16px 64px;
        gap: 28px;
        position: relative;
      }

      .back {
        position: absolute;
        top: 24px;
        left: 24px;
        text-decoration: none;
        color: var(--text);
        padding: 10px 18px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        font-size: 12px;
        letter-spacing: 0.16em;
        text-transform: uppercase;
      }

      .logo {
        width: min(520px, 88vw);
        height: auto;
        display: block;
        filter: drop-shadow(0 18px 40px rgba(0, 0, 0, 0.5));
      }

      .card {
        width: min(720px, 92vw);
        background: var(--card);
        border-radius: 28px;
        padding: 28px 24px 32px;
        box-shadow: var(--shadow);
        border: 1px solid var(--border);
        display: grid;
        gap: 18px;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .card::before {
        content: "";
        position: absolute;
        inset: -40% 45% 45% -40%;
        background: radial-gradient(
          circle,
          rgba(191, 213, 179, 0.2),
          transparent 70%
        );
        opacity: 0.7;
      }

      .card::after {
        content: "";
        position: absolute;
        inset: 55% -20% -20% 55%;
        background: radial-gradient(
          circle,
          rgba(143, 191, 155, 0.18),
          transparent 70%
        );
        opacity: 0.7;
      }

      .card > * {
        position: relative;
        z-index: 1;
      }

      .eyebrow {
        margin: 0;
        font-size: 14px;
        letter-spacing: 0.26em;
        text-transform: uppercase;
        color: var(--accent);
        font-family: "Sedgwick Ave Display", "Segoe UI", sans-serif;
      }

      h1 {
        margin: 0;
        font-size: clamp(32px, 5vw, 44px);
        font-weight: 500;
        letter-spacing: 0.04em;
        font-family: "Sedgwick Ave Display", "Segoe UI", sans-serif;
      }

      .result {
        margin: 0;
        font-size: clamp(18px, 3.6vw, 24px);
        color: var(--muted);
        min-height: 2.4em;
        white-space: pre-line;
      }

      .result.is-active {
        color: var(--text);
        animation: pop-in 0.35s ease;
      }

      .random-btn {
        border: none;
        border-radius: 999px;
        padding: 14px 26px;
        font-size: 12px;
        letter-spacing: 0.18em;
        text-transform: uppercase;
        background: linear-gradient(120deg, var(--accent), var(--accent-2));
        color: #161a14;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.35);
        transition: transform 0.25s ease, box-shadow 0.25s ease;
      }

      .ai-input {
        width: min(100%, 520px);
        min-height: 110px;
        padding: 12px 14px;
        border-radius: 16px;
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.04);
        color: var(--text);
        font-family: inherit;
        font-size: 16px;
        resize: vertical;
      }

      .ai-input::placeholder {
        color: var(--muted);
      }

      .ai-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        justify-content: center;
      }

      .random-btn.is-loading {
        opacity: 0.7;
        cursor: wait;
      }

      .random-btn:hover,
      .random-btn:focus-visible {
        transform: translateY(-2px);
        box-shadow: 0 18px 32px rgba(0, 0, 0, 0.45);
      }

      @keyframes pop-in {
        from {
          opacity: 0;
          transform: translateY(6px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (max-width: 600px) {
        main {
          padding-top: 76px;
        }

        .back {
          position: static;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        .random-btn,
        .result.is-active {
          animation: none;
          transition: none;
        }
      }
    </style>
  </head>
  <body>
    <main>
      <a class="back" href="../index.html">Volver</a>
      <img class="logo" src="logos/logo.png" alt="Randomizador" />
      <section class="card">
        <h1>¿Qué hacemos hoy?</h1>
        <p class="result" id="result" aria-live="polite">
          Escribe la situación y pídeme un plan.
        </p>
        <textarea
          class="ai-input"
          id="ai-input"
          placeholder="Ej: Estamos cansados, queremos algo en casa, poco presupuesto."
        ></textarea>
        <div class="ai-actions">
          <button class="random-btn" id="ai-btn" type="button">
            Pedir plan a la IA
          </button>
          <button class="random-btn" id="random-btn" type="button">
            Sorpréndeme
          </button>
        </div>
      </section>
    </main>
    <script>
      const plans = [
        "Cine en casa con palomitas",
        "Cena sorpresa",
        "Paseo nocturno",
        "Playlist y baile",
        "Juegos de mesa",
        "Picnic en el salón",
        "Fotos juntos",
        "Helado y charla",
      ];

      const resultEl = document.getElementById("result");
      const buttonEl = document.getElementById("random-btn");
      const aiInput = document.getElementById("ai-input");
      const aiButton = document.getElementById("ai-btn");
      const workerUrl = "https://ourportal.pablomerino2008.workers.dev";
      let lastIndex = -1;

      const setResult = (text) => {
        resultEl.classList.remove("is-active");
        void resultEl.offsetWidth;
        resultEl.textContent = text;
        resultEl.classList.add("is-active");
      };

      const pickPlan = () => {
        if (plans.length === 0) return;
        let index = Math.floor(Math.random() * plans.length);
        if (plans.length > 1) {
          while (index === lastIndex) {
            index = Math.floor(Math.random() * plans.length);
          }
        }
        lastIndex = index;
        setResult(plans[index]);
      };

      const askAI = async () => {
        const prompt = (aiInput.value || "").trim();
        if (!prompt) {
          setResult("Escribe una situación primero.");
          return;
        }
        aiButton.classList.add("is-loading");
        aiButton.disabled = true;
        aiButton.textContent = "Pensando...";
        setResult("La IA está pensando...");
        try {
          const response = await fetch(workerUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ prompt }),
          });
          if (!response.ok) {
            throw new Error("Request failed");
          }
          const data = await response.json();
          setResult(data.text || "No pude generar un plan.");
        } catch (error) {
          setResult("No pude conectarme con la IA. Inténtalo otra vez.");
        } finally {
          aiButton.classList.remove("is-loading");
          aiButton.disabled = false;
          aiButton.textContent = "Pedir plan a la IA";
        }
      };

      buttonEl.addEventListener("click", pickPlan);
      aiButton.addEventListener("click", askAI);
    </script>
  </body>
</html>
